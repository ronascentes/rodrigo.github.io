<!-- This is an automatically generated file, do not edit it directly -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Como consultar o número de linhas de uma tabela rapidamente no SQL Server</title>
    <meta charset="UTF-8" />

    <!-- SEO -->
    <meta name="author" content="Rodrigo Nascentes" />
    <meta name="description" content="Uma tarefa comum tanto na administração ou no desenvolvimento de banco de dados é consultar o número de linhas de uma tabela. Nesse artigo mostrarei quatro maneiras distintas de como consultar o número de linhas de uma tabela eficientemente." />
    <meta property="og:title" content="Como consultar o número de linhas de uma tabela rapidamente no SQL Server" />
    <meta property="og:description" content="Uma tarefa comum tanto na administração ou no desenvolvimento de banco de dados é consultar o número de linhas de uma tabela. Nesse artigo mostrarei quatro maneiras distintas de como consultar o número de linhas de uma tabela eficientemente." />
    <meta property="og:site_name" content="Rodrigo Nascentes" />
    <meta property="og:url" content="https://ronascentes.github.io/posts/como-consultar-o-numero-de-linhas-de-uma-tabela-rapidamente" />
    <meta property="og:image" content="https://ronascentes.github.io/card.jpg" />
    <meta property="og:type" content="Website" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="627" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="Rodrigo Nascentes" />
    <meta name="twitter:creator" content="Rodrigo Nascentes" />
    <meta name="twitter:title" content="Como consultar o número de linhas de uma tabela rapidamente no SQL Server" />
    <meta name="twitter:description" content="Uma tarefa comum tanto na administração ou no desenvolvimento de banco de dados é consultar o número de linhas de uma tabela. Nesse artigo mostrarei quatro maneiras distintas de como consultar o número de linhas de uma tabela eficientemente." />
    <meta name="twitter:image:src" content="https://ronascentes.github.io/card.jpg" />
    <!--  -->

    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Language" content="en" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link rel="icon" href="../../favicon.png" />
    <link
      href="https://unpkg.com/plume-css@1.0.13/lib/plume-all.css"
      rel="stylesheet"
      rel="preload"
      as="style"
      media="all"
      defer
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/1post@1.0.3/themes/default-dark.css"
    />
    <link
      href="https://unpkg.com/prismjs@1.28.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />

    <style>
      :root {
        --pm-paragraph-font-size: 1.1em;
        --pm-paragraph-font-family: var(--pm-font-family-secondary);
      }

      .plume .pm-link,
      .plume a {
        font-size: var(--pm-paragraph-font-size);
      }

      .plume li {
        font-family: var(--pm-font-family-secondary);
        font-size: var(--pm-paragraph-font-size);
      }
    </style>
  </head>
  <body class="plume">
    <div class="pm-container">
      <h2>Como consultar o número de linhas de uma tabela rapidamente no SQL Server</h2>

      <p>
        <a href="../..">← ← ←</a> &nbsp; 8/16/2023, 5:19:12 PM |
        <strong>Posted by:</strong>
        <a href="https://ronascentes.github.io" target="_blank" rel="noreferrer noopener"
          >Rodrigo Nascentes</a
        >
      </p>

      <hr />

      

<p>Uma tarefa comum tanto na administração ou no desenvolvimento de banco de dados é consultar o número de linhas de uma tabela. Nesse artigo mostrarei quatro maneiras distintas de como consultar o número de linhas de uma tabela eficientemente.</p>
<h4 id="método-1--o-intuitivo">Método 1 — O Intuitivo</h4>
<p>Talvez a forma mais intuitiva e fácil de consultar o número de linhas de uma tabela é utilizar a função <code>COUNT()</code>, como, por exemplo, <code>SELECT COUNT(&lt;nome_do_campo&gt;) FROM &lt;nome_da_tabela&gt;</code>. Apesar desse método retornar um número preciso de linhas, ele torna-se lento proporcionalmente ao número de linhas da tabela. Isso se deve ao fato que motor de consulta irá, inevitavelmente, ler TODAS as linhas da tabela, e não importa se o campo utilizado seja um index clusterizado ou não clusterizado pois não há benefício de index. Além disso, se for executado em uma tabela com uma alta carga de trabalho, esse tipo de consulto pode causar excessivos bloqueios (<em>locks</em>). Por isso, o Método 1 é somente recomendado para tabelas com poucas linhas e/ou em ambientes de testes ou de não-produção.</p>
<pre><code class="language-SQL">SELECT COUNT(id) from Employees;
</code></pre>
<br/>

<h4 id="método-2--rápido-mas-não-preciso">Método 2 — Rápido mas não preciso</h4>
<p>Selecionar o campo rows da tabela <em>sys.sysindexes</em> é o método mais rápido para consultar o número de linhas. No entanto, tal rapidez sacrifica a precisão do valor do número de linhas, uma vez que, depende se as estatísticas estão atualizadas. Além disso, a tabela <em>sys.sysindexes</em> está em processo de descomissionamento, ou seja, será removida em uma versão futura do Microsoft SQL Server.</p>
<pre><code class="language-SQL">SELECT rows FROM sys.sysindexes
WHERE id = OBJECT_ID (&#39;&lt;table_name&gt;&#39;)
AND indid &lt; 2;
</code></pre>
<br/>

<h4 id="método-3--por-debaixo-dos-panos">Método 3 — Por debaixo dos panos</h4>
<p>O método 3 é como o SQL Server Management Studio consulta o número de linhas de uma tabela por debaixo dos panos. Veja em <em>Table Properties &gt; Storage &gt; Row count</em>. Usa três tabelas diferentes para mostrar um número mais preciso de linhas ao custo de adicionar JOINs na consulta. São necessários dois paramêtros: (1) o nome da tabela e (2) o nome do <em>schema</em>.</p>
<pre><code class="language-SQL">SELECT CAST(p.rows AS float)
FROM sys.tables AS tbl
INNER JOIN sys.indexes AS idx ON idx.object_id = tbl.object_id and idx.index_id &lt; 2
INNER JOIN sys.partitions AS p ON p.object_id=CAST(tbl.object_id AS int)
AND p.index_id=idx.index_id
WHERE ((tbl.name=N&#39;&lt;table_name&gt;&#39;
AND SCHEMA_NAME(tbl.schema_id)=&#39;&lt;schema_name&gt;&#39;));
</code></pre>
<br/>

<h4 id="método-4--o-moderninho">Método 4 — O Moderninho</h4>
<p>Talvez o método com o melhor custo-benefício pois retorna um valor aproximado número de linhas usando uma consulta simples à uma <a href="https://learn.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/database-related-dynamic-management-views-transact-sql?view=azuresqldb-current&viewFallbackFrom=sql-server-ver16">Dynamic Management Views</a>, nesse caso à <em>sys.dm_db_partition_stats</em>. As DMVs permitem ao usuário um mecanismo para ver informações do <em>Database Engine</em>, o chamado de SQLOS (<em>SQL Operating System</em>), que foi introduzido no SQL Server 2005, de forma rápida, simplificada e leve. </p>
<pre><code class="language-SQL">SELECT SUM (row_count)
FROM sys.dm_db_partition_stats
WHERE object_id=OBJECT_ID(&#39;&lt;table_name&gt;&#39;)   
AND (index_id = 0 or index_id = 1);
</code></pre>
<br/>

<h4 id="bônus">BÔNUS:</h4>
<h4 id="método-5---o-velhinho-que-ainda-funciona">Método 5 - O Velhinho que ainda funciona</h4>
<p>Por que não comentar sobre a <code>sp_spaceused</code>? Esse procedimento de sistema foi herdado do código do Sybase (quem não sabe, o SQL Server é derivado do código base do Sybase). Além do número de linhas retorna, também, espaço em disco reservado e espaço em disco usado por uma tabela. Particularmente eu não gosto de usar os procedimentos legados do SQL Server (mas não estou dizendo que são ruins ou que não funcionam) mas sim as DMVs, como no Método 4, que são mais modernas e oferecem uma acesso leve e simplificado.</p>
<pre><code class="language-SQL">EXEC sp_spaceused N&#39;dbo.Employees&#39;; 
</code></pre>
<br/>

<p>I know this is only SQL but I like it.</p>


      <hr />
      <p style="--pm-paragraph-font-size: 0.7em">
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"
          ><img
            alt="Licença Creative Commons"
            style="border-width: 0"
            src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a
        ><br />Este obra está licenciado com uma Licença
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"
          >Creative Commons Atribuição 4.0 Internacional</a
        >.
      </p>
    </div>
    <!-- Prism Code Highlighting -->
    <script src="https://unpkg.com/prismjs@1.28.0/components/prism-core.min.js"></script>
    <script src="https://unpkg.com/prismjs@1.28.0/plugins/autoloader/prism-autoloader.min.js"></script>
  </body>
</html>
